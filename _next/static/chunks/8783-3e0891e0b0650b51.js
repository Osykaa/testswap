"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8783],{3820:function(e,t,r){r.d(t,{uw:function(){return A}});var a=r(43144),s=r(60136),n=r(82963),o=r(61120),i=r(15671),l=r(4942),u=r(84772),c=r(75416),d=r(11324),f=r(84243),h=r(21815);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,o.Z)(e);if(t){var s=(0,o.Z)(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return(0,n.Z)(this,r)}}var v=function e(t,r,a){(0,i.Z)(this,e),(0,l.Z)(this,"address",""),(0,l.Z)(this,"name","None"),(0,l.Z)(this,"data",""),(0,l.Z)(this,"warning",""),(0,l.Z)(this,"error",""),(0,l.Z)(this,"chainId",u.a_.MAINNET),(0,l.Z)(this,"pair",void 0),(0,l.Z)(this,"tokens",void 0),(0,l.Z)(this,"valid",void 0),this.address=t.oracle,this.data=t.oracleData,this.pair=t,this.chainId=r,this.tokens=a,this.valid=!1},p=function(e){(0,s.Z)(r,e);var t=m(r);function r(e,a,s){var n;return(0,i.Z)(this,r),(n=t.call(this,e,a,s)).name="Chainlink",n.valid=n.validate(),n}return(0,a.Z)(r,[{key:"validate",value:function(){var e=c.M[this.chainId];if(!e)return!1;var t=f.$.decode(["address","address","uint256"],this.data),r=54,a="",s="";if(t[0]!==h.AddressZero){if(!e[t[0]])return this.error="One of the Chainlink oracles used is not configured in this UI.",!1;r-=18-e[t[0]].decimals,a=e[t[0]].from,s=e[t[0]].to}if(t[1]!==h.AddressZero){if(!e[t[1]])return this.error="One of the Chainlink oracles used is not configured in this UI.",!1;if(r-=e[t[1]].decimals,s){if(s!==e[t[1]].to)return this.error="The Chainlink oracles used don't match up with eachother. If 2 oracles are used, they should have a common token, such as WBTC/ETH and LINK/ETH, where ETH is the common link.",!1;s=e[t[1]].from}else a=e[t[1]].to,s=e[t[1]].from}if(a===this.pair.assetAddress&&s===this.pair.collateralAddress&&this.tokens[this.pair.collateralAddress]&&this.tokens[this.pair.assetAddress]){var n=this.tokens[this.pair.collateralAddress].decimals+18-this.tokens[this.pair.assetAddress].decimals;return!!(0,d.TB)(r-n).eq(t[2])||(this.error="The divider parameter is misconfigured for this oracle, which leads to rates that are order(s) of magnitude wrong.",!1)}return this.error="The Chainlink oracles configured don't match the pair tokens.",!1}}]),r}(v);function A(e,t,r){if(a=e.oracle,s=u.uA[t],a.toLowerCase()===s.toLowerCase())return new p(e,t,r);var a,s}},18783:function(e,t,r){r.d(t,{BA:function(){return W},Fp:function(){return $},c0:function(){return H}});var a,s=r(15671),n=r(43144),o=r(60136),i=r(82963),l=r(61120),u=r(88467),c=r(15861),d=r(4942),f=r(87757),h=r.n(f),m=r(84772),v=r(67294),p=r(11324),A=r(15144),b=r(98765),y=r(47083),g=r(2593),w=r(4610),x=r(35509),B=r(84243),P=r(19485),k=r(39413),C=r(3820),E=r(77058),T=r(11178),O=r(62483),Z=r(90849),R=r(24575),S=r(79648),I=r(85893);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,l.Z)(e);if(t){var s=(0,l.Z)(this).constructor;r=Reflect.construct(a,arguments,s)}else r=a.apply(this,arguments);return(0,i.Z)(this,r)}}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e.UPDATE="UPDATE",e.SYNC="SYNC"}(a||(a={}));var j={info:{ethBalance:p.xE,sushiBalance:p.xE,sushiBarBalance:p.xE,xsushiBalance:p.xE,xsushiSupply:p.xE,sushiBarAllowance:p.xE,factories:[],ethRate:p.xE,sushiRate:p.xE,btcRate:p.xE,pendingSushi:p.xE,blockTimeStamp:p.xE,masterContractApproved:[]},pairs:[]},M=(0,v.createContext)({state:j,dispatch:function(){return null}}),_=function(e,t){switch(t.type){case a.SYNC:return Y({},e);case a.UPDATE:var r=t.payload,s=r.info,n=r.pairs;return Y(Y({},e),{},{info:s,pairs:n});default:return e}};function U(e,t){return F.apply(this,arguments)}function F(){return(F=(0,c.Z)(h().mark((function e(t,r){var a,s,n;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],s=!1,n=m.MO[r],r===m.a_.BSC||r===m.a_.MATIC){e.next=8;break}return e.next=6,t.queryFilter(t.filters.LogDeploy(n));case 6:a=e.sent,s=!0;case 8:if(s){e.next=12;break}return e.next=11,x.bentobox.clones({masterAddress:n,chainId:r});case 11:a=e.sent.map((function(e){return{args:{masterContract:n,cloneAddress:e.address,data:e.data}}}));case 12:return e.abrupt("return",a.map((function(e){var t,r,a,s=B.$.decode(["address","address","address","bytes"],null===(t=e.args)||void 0===t?void 0:t.data);return{masterContract:null===(r=e.args)||void 0===r?void 0:r.masterContract,address:null===(a=e.args)||void 0===a?void 0:a.cloneAddress,collateralAddress:s[0],assetAddress:s[1],oracle:s[2],oracleData:s[3]}})));case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=function(e){(0,o.Z)(r,e);var t=D(r);function r(){return(0,s.Z)(this,r),t.apply(this,arguments)}return(0,n.Z)(r,[{key:"add",value:function(e){return this[e]||(this[e]={address:e}),this[e]}}]),r}((0,u.Z)(Array));function L(e,t){if(e instanceof g.O$)return e;if(t||(t={}),"object"===typeof e){if(Object.keys(e).length&&isNaN(Number(Object.keys(e)[Object.keys(e).length-1]))){for(var r in e)isNaN(Number(r))&&(t[r]=L(e[r]));return t}return e.map((function(e){return L(e)}))}return e}var z=["0x8f2CC3376078568a04eBC600ae5F0a036DBfd812"];function W(){var e=(0,v.useContext)(M);if(void 0===e)throw new Error("useKashiInfo must be used within a KashiProvider");return e.state.info}function $(){var e=(0,v.useContext)(M);if(void 0===e)throw new Error("useKashiPairs must be used within a KashiProvider");return e.state.pairs}function H(e){var t=(0,v.useContext)(M);if(void 0===t)throw new Error("useKashiPair must be used within a KashiProvider");return t.state.pairs.find((function(t){return(0,P.getAddress)(t.address)===(0,P.getAddress)(e)}))}t.ZP=function(e){var t=e.children,r=(0,v.useReducer)(_,j),s=r[0],n=r[1],o=(0,Z.Ov)(),i=(0,T.a)(),l=i.account,u=i.chainId,d=m.FX[u],f=(0,k.zC)(u).address,x=(0,y.HW)(),B=(0,y.rO)(),P=(0,O.e_)(),D=(0,S.Mh)({chainId:u,shouldFetch:u&&(u===m.a_.MAINNET||u===m.a_.MATIC)}),N=(0,v.useCallback)((0,c.Z)(h().mark((function e(){var t,r,s,o,i,c,v,y,k;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l&&u&&[m.a_.MAINNET,m.a_.KOVAN,m.a_.BSC,m.a_.MATIC,m.a_.XDAI,m.a_.ARBITRUM,m.a_.AVALANCHE].includes(u)){e.next=2;break}return e.abrupt("return");case 2:if(!x||!B){e.next=33;break}return e.t0=L,e.next=6,x.getUIInfo(l,[],f,[m.MO[u]]);case 6:return e.t1=e.sent,t=(0,e.t0)(e.t1),e.next=10,U(B,u);case 10:return r=e.sent.filter((function(e){return!z.includes(e.oracle)})),s=[],o=r.filter((function(e){var t=(0,C.uw)(e,u,P);return!!t&&(t.valid||s.push({pair:e,error:t.error}),t.valid)})).map((function(e){return e.address})),console.log("invalidOracles",s),e.t2=L,e.next=17,x.pollKashiPairs(l,o);case 17:return e.t3=e.sent,i=(0,e.t2)(e.t3),(c=new K).add(f),i.forEach((function(e,t){e.address=o[t],e.collateral=c.add(e.collateral),e.asset=c.add(e.asset)})),v=Object.values(c).map((function(e){return e.address})),e.t4=L,e.next=26,x.getBalances(l,v);case 26:e.t5=e.sent,y=(0,e.t4)(e.t5),k=[],y.forEach((function(e,t){P[e.token]?Object.assign(c[e.token],P[e.token]):k.push(e.token),Object.assign(c[e.token],e)})),k.length&&console.log("missing tokens length",k.length),Object.values(c).forEach((function(e){e.symbol=e.address===d.address?m.B5[u].symbol:e.tokenInfo.symbol,e.usd=(0,p.TB)(e.tokenInfo.decimals).mulDiv(c[f].rate,e.rate),e.strategy=null===D||void 0===D?void 0:D.find((function(t){return t.token===e.address.toLowerCase()}))})),n({type:a.UPDATE,payload:{info:t,pairs:i.filter((function(e){return e.asset!==e.collateral})).map((function(e,t){var r,a,s,n,o,i,l,c;return e.elapsedSeconds=g.O$.from(Date.now()).div("1000").sub(e.accrueInfo.lastAccrued),e.interestPerYear=e.accrueInfo.interestPerSecond.mul("60").mul("60").mul("24").mul("365"),e.totalCollateralAmount=(0,A.bi)((0,b.s)(e.collateral,e.totalCollateralShare),e.collateral),e.totalAssetAmount=(0,A.bi)((0,b.s)(e.asset,e.totalAsset.elastic),e.asset),e.currentBorrowAmount=(0,A.bi)((0,A.Mu)(e,e.totalBorrow.elastic,!0),e.asset),e.currentAllAssets=(0,A.bi)(e.totalAssetAmount.value.add(e.currentBorrowAmount.value),e.asset),e.marketHealth=e.totalCollateralAmount.value.mulDiv((0,p.TB)(18),(0,p.gW)(e.currentExchangeRate,e.oracleExchangeRate,e.spotExchangeRate)).mulDiv((0,p.TB)(18),e.currentBorrowAmount.value),e.currentTotalAsset=(0,A.zK)(e),e.currentAllAssetShares=(0,b.T)(e.asset,e.currentAllAssets.value),e.maxAssetAvailable=(0,p.LT)(e.totalAsset.elastic.mulDiv(e.currentAllAssets.value,e.currentAllAssetShares),(0,b.s)(e.asset,(0,E.N)(e.currentTotalAsset,e.totalAsset.base.sub(1e3),!1))),e.maxAssetAvailableFraction=e.maxAssetAvailable.mulDiv(e.currentTotalAsset.base,e.currentAllAssets.value),e.utilization=(0,p.TB)(18).mulDiv(e.currentBorrowAmount.value,e.currentAllAssets.value),e.supplyAPR=(0,A.Ym)(e.interestPerYear.mulDiv(e.utilization,(0,p.TB)(18))),e.currentInterestPerYear=(0,A.FO)(e,e.interestPerYear),e.currentSupplyAPR=(0,A.Ym)(e.currentInterestPerYear.mulDiv(e.utilization,(0,p.TB)(18))),e.userCollateralAmount=(0,A.bi)((0,b.s)(e.collateral,e.userCollateralShare),e.collateral),e.currentUserAssetAmount=(0,A.bi)(e.userAssetFraction.mulDiv(e.currentAllAssets.value,e.totalAsset.base),e.asset),e.currentUserBorrowAmount=(0,A.bi)(e.userBorrowPart.mulDiv(e.currentBorrowAmount.value,e.totalBorrow.base),e.asset),e.currentUserLentAmount=(0,A.bi)(e.userAssetFraction.mulDiv(e.currentBorrowAmount.value,e.totalAsset.base),e.asset),e.feesEarned=(0,A.bi)(e.accrueInfo.feesEarnedFraction.mulDiv(e.currentAllAssets.value,e.totalAsset.base),e.asset),e.maxBorrowable={oracle:e.userCollateralAmount.value.mulDiv((0,p.TB)(16).mul("75"),e.oracleExchangeRate),spot:e.userCollateralAmount.value.mulDiv((0,p.TB)(16).mul("75"),e.spotExchangeRate),stored:e.userCollateralAmount.value.mulDiv((0,p.TB)(16).mul("75"),e.currentExchangeRate)},e.maxBorrowable.minimum=(0,p.LT)(e.maxBorrowable.oracle,e.maxBorrowable.spot,e.maxBorrowable.stored),e.maxBorrowable.safe=e.maxBorrowable.minimum.mulDiv("95","100").sub(e.currentUserBorrowAmount.value),e.maxBorrowable.possible=(0,p.LT)(e.maxBorrowable.safe,e.maxAssetAvailable),e.safeMaxRemovable=p.xE,e.health=e.currentUserBorrowAmount.value.mulDiv((0,p.TB)(18),e.maxBorrowable.minimum),e.netWorth=(0,A.xM)(e.currentUserAssetAmount.value.sub(e.currentUserBorrowAmount.value),e.asset).add((0,A.xM)(e.userCollateralAmount.value,e.collateral)),e.search=e.asset.tokenInfo.symbol+"/"+e.collateral.tokenInfo.symbol,e.oracle=(0,C.uw)(e,u,P),e.interestPerYear={value:e.interestPerYear,string:e.interestPerYear.toFixed(16)},e.strategyAPY={asset:{value:g.O$.from(String(Math.floor(1e16*(null!==(r=null===(a=e.asset.strategy)||void 0===a?void 0:a.apy)&&void 0!==r?r:0)))),string:String(null!==(s=null===(n=e.asset.strategy)||void 0===n?void 0:n.apy)&&void 0!==s?s:0)},collateral:{value:g.O$.from(String(Math.floor(1e16*(null!==(o=null===(i=e.collateral.strategy)||void 0===i?void 0:i.apy)&&void 0!==o?o:0)))),string:String(null!==(l=null===(c=e.collateral.strategy)||void 0===c?void 0:c.apy)&&void 0!==l?l:0)}},e.supplyAPR={value:e.supplyAPR,valueWithStrategy:e.supplyAPR.add(e.strategyAPY.asset.value),string:w.Z.from(e.supplyAPR,(0,p.TB)(16)).toString(),stringWithStrategy:w.Z.from(e.strategyAPY.asset.value.add(e.supplyAPR),(0,p.TB)(16)).toString()},e.currentSupplyAPR={value:e.currentSupplyAPR,valueWithStrategy:e.currentSupplyAPR.add(e.strategyAPY.asset.value),string:w.Z.from(e.currentSupplyAPR,(0,p.TB)(16)).toString(),stringWithStrategy:w.Z.from(e.currentSupplyAPR.add(e.strategyAPY.asset.value),(0,p.TB)(16)).toString()},e.currentInterestPerYear={value:e.currentInterestPerYear,string:w.Z.from(e.currentInterestPerYear,g.O$.from(10).pow(16)).toString()},e.utilization={value:e.utilization,string:w.Z.from(e.utilization,g.O$.from(10).pow(16)).toString()},e.health={value:e.health,string:w.Z.from(e.health,(0,p.TB)(16))},e.maxBorrowable={oracle:(0,A.bi)(e.maxBorrowable.oracle,e.asset),spot:(0,A.bi)(e.maxBorrowable.spot,e.asset),stored:(0,A.bi)(e.maxBorrowable.stored,e.asset),minimum:(0,A.bi)(e.maxBorrowable.minimum,e.asset),safe:(0,A.bi)(e.maxBorrowable.safe,e.asset),possible:(0,A.bi)(e.maxBorrowable.possible,e.asset)},e.safeMaxRemovable=(0,A.bi)(e.safeMaxRemovable,e.collateral),e}))}});case 33:case"end":return e.stop()}}),e)}))),[l,u,x,B,f,P,D]),Y=(0,R.Z)(o),F=(0,R.Z)(D);return(0,v.useEffect)((function(){o!==Y&&N(),D!==F&&N()}),[o,Y,D,F,N]),(0,I.jsx)(M.Provider,{value:{state:s,dispatch:n},children:t})}}}]);